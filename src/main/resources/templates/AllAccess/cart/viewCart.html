<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Mon Panier</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">

<!-- âœ… Menu de navigation -->
<div th:replace="~{fragments/header :: siteHeader}"></div>

<!-- âœ… Section principale -->
<section class="d-flex justify-content-center align-items-center"
         style="min-height: 100vh; background-image: url('/img/olympe.jpg'); background-size: cover; background-position: center;">
    <div class="container bg-dark bg-opacity-75 p-5 rounded-4 shadow-lg" style="max-width: 1100px;">

        <h1 class="text-center mb-4 fw-bold">ğŸ›ï¸ Mon Panier</h1>

        <!-- âœ… Total global -->
        <div class="text-center mb-5 fs-4">
            Total du panier :
            <span id="cart-total" class="text-warning fw-bold"
                  th:text="${#numbers.formatDecimal(total, 1, 'COMMA', 2, 'POINT')} + ' â‚¬'">0,00 â‚¬</span>
        </div>

        <!-- âœ… Tableau des articles -->
        <div th:if="${!#lists.isEmpty(cart.items)}" class="table-responsive">
            <table class="table table-dark table-striped table-hover align-middle rounded-3 overflow-hidden">
                <thead class="table-light text-dark">
                <tr>
                    <th>Ã‰vÃ©nement</th>
                    <th>Session</th>
                    <th>Date de dÃ©but</th>
                    <th>Date de fin</th>
                    <th class="text-center">QuantitÃ©</th>
                    <th class="text-end">Prix unitaire</th>
                    <th class="text-end">Sous-total</th>
                    <th class="text-center">Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${cart.items}" th:data-session-id="${item.session.id}">
                    <td th:text="${item.session.event.name}">AthlÃ©tisme</td>
                    <td th:text="${item.session.name}">Finale 100m</td>
                    <td th:text="${#temporals.format(item.session.startTime, 'dd/MM/yyyy Ã  HH:mm')}">20/07/2025 Ã  10:00</td>
                    <td th:text="${#temporals.format(item.session.endTime, 'dd/MM/yyyy Ã  HH:mm')}">20/07/2025 Ã  12:00</td>

                    <td class="text-center">
                        <input type="number" min="1" class="form-control text-center quantity-input"
                               th:value="${item.quantity}" style="max-width: 80px;">
                    </td>
                    <td class="text-end" th:text="${#numbers.formatDecimal(item.session.price, 1, 'COMMA', 2, 'POINT')} + ' â‚¬'">49,00 â‚¬</td>
                    <td class="text-end subtotal text-warning fw-bold"
                        th:text="${#numbers.formatDecimal(item.session.price * item.quantity, 1, 'COMMA', 2, 'POINT')} + ' â‚¬'">98,00 â‚¬</td>

                    <!-- Actions -->
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-light update-btn me-1">â†»</button>
                        <button class="btn btn-sm btn-danger delete-btn">ğŸ—‘ï¸</button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- âœ… Panier vide -->
        <div th:if="${#lists.isEmpty(cart.items)}" class="text-center mt-5">
            <div class="alert alert-info fs-5 bg-opacity-75">
                Votre panier est vide ğŸ˜¢
            </div>
            <a class="btn btn-success btn-lg px-4 mt-3" th:href="@{/}">
                ğŸŸï¸ Voir les prochains Ã©vÃ©nements
            </a>
        </div>

        <!-- âœ… Actions si connectÃ© -->
        <div th:if="${#authorization.expression('isAuthenticated()') and !#lists.isEmpty(cart.items)}"
             class="d-flex justify-content-center mt-5">
            <a class="btn btn-success btn-lg px-5" th:href="@{/all/order}">
                âœ… Valider le panier
            </a>
        </div>

        <!-- âœ… Actions si non connectÃ© -->
        <div th:if="${#authorization.expression('!isAuthenticated()') and !#lists.isEmpty(cart.items)}"
             class="d-flex justify-content-center mt-5">
            <a class="btn btn-primary btn-lg px-5" th:href="@{/login}">
                ğŸ” Connectez-vous pour finaliser votre commande
            </a>
        </div>
    </div>
</section>

<!-- âœ… Footer -->
<footer id="contact" class="bg-dark text-center text-light py-4 mt-5">
    <p class="mb-0">
        &copy; 2025 Jeux Olympiques Paris |
        Contactez-nous :
        <a href="mailto:contact@paris2025.com" class="text-light text-decoration-underline">
            contact@paris2025.com
        </a>
    </p>
</footer>

<!-- âœ… JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/cartUpdate.js}"></script>

</body>
</html>